{% extends "root/blocks/contentlist.html.twig" %} 
{% block mainContent %}

<br />
<div class="navbar">
	<div class="navbar-inner search-nav">
		<a class="brand">{% if total > 1 %}{{"there_are"|fotrans}}{% else %}{{"there_is"|fotrans}}{% endif %} <span class="badge badge-important">{{ total }}</span> {% if total > 1 %}{{"result_pl"|fotrans}}{% else %}{{"result_sg"|fotrans}}{% endif %}</a>
		<ul class="nav pull-right">
			<li class="dropdown">
				<a class="dropdown-toggle" data-toggle="dropdown" href="#"> {% if pagesize=="all" %}
				{{"all_on_one_page"|fotrans}}
				{% else %}
				{{ pagesize }} {{"by_page"|fotrans}}
				{% endif %} <b class="caret"></b> </a>
				<ul class="dropdown-menu">
					<li>
						<a href="{{url({'pagesize': '10'})}}">10 {{"by_page"|fotrans}}</a>
					</li>
					<li>
						<a href="{{url({'pagesize': '20'})}}">20 {{"by_page"|fotrans}}</a>
					</li>
					<li>
						<a href="{{url({'pagesize': '50'})}}">50 {{"by_page"|fotrans}}</a>
					</li>
					<li>
						<a href="{{url({'pagesize': 'all'})}}">{{"all_on_one_page"|fotrans}}</a>
					</li>
				</ul>
			</li>
		</ul>
	</div>
</div>
{% if activeFacets|length > 0 %}
<div class="navbar">
	<div class="navbar-inner search-nav">
		<p class="brand">Crit√®res de recherche :&nbsp;&nbsp;
		{% for facet in activeFacets %}
		    {% if facet.id == 'type' or facet.id == 'damType' or facet.id == 'author' %}
                {% for term in facet.terms %}
	                <a href="{{url({(facet.id): null})}}" >
					<span class="badge badge-info"><i class="icon-remove-sign"></i> {{ term.label }}</span>
				    </a>
		        {% endfor %}
            {% else %}
                {% for term in facet.terms %}
                    {% if not (constrainToSite and facet.id == 'navigation' and term.term == currentSite) %}
		            <a href="{{url({(facet.id): term.term},'sub')}}" >
				        <span class="badge badge-info"><i class="icon-remove-sign"></i> {{ term.label }}</span>
			        </a>
			        {% endif %}
		        {% endfor %}
            {% endif %}
		        
		{% endfor %}
		</p>
	</div>
</div>
{% endif %}
<div class="row-fluid">
	<div class="span3 well well-large search-menu">
		<p>
			<i class="icon-search"></i> {{"full_text_search"|fotrans}}
		</p>
			<form class="form-search" action="{{url({},true)}}">
				<input type="text" class="input-medium search-query" name="query" size="10" value="{{ query }}" placeholder="{{"search"|fotrans}}">
			</form>
		
		{% for facet in facets %}

			{% if facet.terms|length > 0 %}

    			{% if facet.id == 'type' %}
    			<p>
    				<i class="icon-file"></i> {{"content_type"|fotrans}}
    			</p>	
    			{% elseif facet.id == 'damType' %}
    			<p>
    				<i class="icon-file"></i> {{"dam_type"|fotrans}}
    			</p>		
    			{% elseif facet.id == 'date' %}
    			<p>
    				<i class="icon-calendar"></i> {{"date"|fotrans}}
    			</p>	
    			{% else %}
    			<p>
    				<i class="icon-tags"></i> {{facet.label}}
    			</p>			
    			{% endif %}	
    	        {% if facet.id == 'type' or facet.id == 'damType' or facet.id == 'author' or facet.id == 'date' %}
    	          <ul>
    				{% for term in facet.terms %}
    				
    				<li>
    					<a href="{{url({(facet.id) : term.term})}}">{{ term.label }} ({{ term.count }})</a>
    				</li>
    				
    				{% endfor %}
			    </ul>
    	        {% else %}
    	        <ul>
    				{% for term in facet.terms %}
    				{% if not (constrainToSite and facet.id == 'navigation' and term.term == currentSite) %}
    				<li>
    					<a href="{{url({(facet.id) : [term.term]},'add')}}">{{ term.label }} ({{ term.count }})</a>
    				</li>
    				{% endif %}
    				{% endfor %}
			    </ul>
    					
    			{% endif %}	
			
			
			{% endif %}
		
		{% endfor %}
		
	</div>
	<div class="span8">
		{% if total == 0 %}
		<div class="alert alert-error">
			{{"no_result"|fotrans}}
		</div>
		{% else %}

		<table class="table">
			{% for result in data %}
			{% if result.objectType == 'content' %}
			<tr>
				<td><h3><a href="{{ displayUrl(result.id, "default") }}">{{ result.title }}</a></h3>
				{% if result.summary %}
				<p>{{ result.summary|cleanHtml }}</p>
				{% endif %}
				</td>
			</tr>
			{% else %}
			<tr>
				<td><h3><a href="/dam?media-id={{ result.id }}">{{ result.title }}</a></h3>
				<div class="progress progress-success" style="width:50px; float: left;">
					<div class="bar {%if result.score >= 70%}bar-success{% else %} bar-warning{%endif%}" style="width: 100%;">
						{{ result.score }}%
					</div>
				</div> &nbsp;<span class="label">{{ result.type }}</span>
				<br />
				<br />
				{% if result.summary %}
				<p><img src="/dam/get-thumbnail?media-id={{ result.id }}" alt='{{ result.title }}'> &nbsp;&nbsp;{{ result.summary|cleanHtml }}</p>
				{% endif %}
				</td>
			</tr>
			{% endif %}
			{% endfor %}
		</table>
		{% if pagecount > 1 %}
		<div class="pagination pagination-centered">
		{%set wrap=limit//2%}
		{%set lastWrap=(pagecount-1)-current%}
			<ul>
			<li class="disabled">
					<a href="#">Page {{ current+1 }} {{"on"|fotrans}} {{ pagecount }}</a>
				</li>
				{% if current==0 %}
				<li class="disabled">
					<a href="#"><<</a>
				</li>
				{% else %}
				<li>
					<a href="{{url({'pager': current-1})}}"><<</a>
				</li>
				{% endif %}
				{%if current<wrap+1 or limit<10%}
				{% for i in range(0, limit) %}
				<li {% if current==i %}class="disabled"{% endif %}>
					<a href="{{url({'pager': i})}}">{{ i+1 }}</a>
				</li>
				{% endfor %}
				{%elseif limit>wrap and current+wrap<pagecount %}
				{% for  i in current-(wrap)..current+wrap%}
				<li {% if current == i%}class="active"{%endif%}>
					<a href="{{url({'pager': i},true)}}">{{i+1}}</a>
				</li>
				{%endfor%}
				{%else%}
				{% for  i in current-(limit-(lastWrap)-1)..current+lastWrap%}
				<li {% if current == i%}class="active"{%endif%}>
					<a href="{{url({'pager': i},true)}}">{{i+1}}</a>
				</li>
				{%endfor%}
				{%endif%}
				{% if current==pagecount-1%}
				<li class="disabled">
					<a href="#">>></a>
				</li>
				{% else %}
				<li>
					<a href="{{url({'pager': current+1})}}">>></a>
				</li>
				{% endif %}
			</ul>
		</div>
		{% endif %}
		{% endif %}
	</div>
</div>

{% endblock %}
